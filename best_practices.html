<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Sparta Modeling Framework: Best Practices, Suggestions on using Sparta</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Sparta Modeling Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('best_practices.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Best Practices, Suggestions on using Sparta </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sparta_asserts">Using Sparta Asserts</a></li>
<li class="level1"><a href="#sparta_expect">Using Sparta compile-time hints</a></li>
<li class="level1"><a href="#cpp_eleven">Take Advantage of C++11/17!</a></li>
<li class="level1"><a href="#discrete_event">How to Use the Port/Event Mechansim Effectively</a><ul><li class="level2"><a href="#phases">Phases</a></li>
<li class="level2"><a href="#using_phase">Using The Phases</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sparta_asserts"></a>
Using Sparta Asserts</h1>
<p>Sparta provides a nifty error dumping/handling mechanism triggered when a model throws a C++ exception. By default, when the framework encounters a C++ exception, it will generate a file called error-dump.txt. See <a class="el" href="end_user.html#debug_dump">3.7 Post-Run Debug dumps</a> for more information.</p>
<p>The make best use of this functionality, consider using <a class="el" href="SpartaAssert_8hpp.html#a64d6ced6d78b1678a0564374f5801c04">sparta_assert</a> whenever possible to catch errors.</p>
<h1><a class="anchor" id="sparta_expect"></a>
Using Sparta compile-time hints</h1>
<p>Sparta defines a set of macros called SPARTA_EXPECT_TRUE and SPARTA_EXPECT_FALSE that help tell the compiler expected behavior for a condition. This enables the compiler to put the common execution path inline for best performance. A best practice is to use these macros for logging messages since they are rarely turned on during full simulation.</p>
<div class="fragment"><div class="line"><a class="code" href="classsparta_1_1log_1_1MessageSource.html">sparta::log::MessageSource</a> my_info_logger_;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MyClass::myBlock()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="SpartaAssert_8hpp.html#adec1baa114339781efa7b68071b82a29">SPARTA_EXPECT_FALSE</a>(my_info_logger_))</div>
<div class="line">    <span class="comment">// if(SPARTA_EXPECT_FALSE(my_info_logger_.observed())  This works too!</span></div>
<div class="line">    {</div>
<div class="line">         my_info_logger_ &lt;&lt; <span class="stringliteral">&quot;myBlock got called&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// ....</span></div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="cpp_eleven"></a>
Take Advantage of C++11/17!</h1>
<p>Since Sparta requires the use of a C++17 compiler, take advantage of the <a href="http://en.wikipedia.org/wiki/C++17">C++17</a> features. This can help reduce errors and clean up code immensely. As an example, try to initialized as many components directly in the header file of the class. Look at example/CoreExample/src/Dispatch.hpp in the CoreExample for examples on how to do this.</p>
<h1><a class="anchor" id="discrete_event"></a>
How to Use the Port/Event Mechansim Effectively</h1>
<p>In this section, Sparta phases and general model flow will be discussed/illustrated.</p>
<h2><a class="anchor" id="phases"></a>
Phases</h2>
<p>Communication between resources in a user's model occurs via Ports. In SystemC, Ports are used as a mechanism to exchange interfaces between blocks, but in Sparta, Ports are used to exchange data and signals at given time intervals. This follows a similar cohesion pattern allowing any component to bind to another as long as it understands the shared data type.</p>
<p>A typical modeled block using Sparta, looks like the following, with each section following the next section in the order listed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Phase  </th><th class="markdownTableHeadNone">Intended Use   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Construction phase (only once):  </td><td class="markdownTableBodyNone">Construction, ports and events registered   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Update phase (runtime):  </td><td class="markdownTableBodyNone">Updating of internal resources (<a class="el" href="classsparta_1_1Pipe.html" title="A very simple pipe, not part of the DES paradigm.">sparta::Pipe</a> for example)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PortUpdate phase (runtime):  </td><td class="markdownTableBodyNone">Port delivery of Data (N-cycle ports)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Flush phase (runtime):  </td><td class="markdownTableBodyNone">Flushing   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Collection phase (runtime):  </td><td class="markdownTableBodyNone">Collection Events   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Tick phase (runtime):  </td><td class="markdownTableBodyNone">Operating Logic/Events   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PostTick phase (runtime):  </td><td class="markdownTableBodyNone">Operating Logic/Events to process after main logic   </td></tr>
</table>
<p>where "Updating of internal resources" are Event objects scheduled/fired that were created in the sparta::SchedulingPhase::Update phase:</p>
<div class="fragment"><div class="line"><a class="code" href="classsparta_1_1Event.html">sparta::Event&lt;sparta::SchedulingPhase::Update&gt;</a> my_updating_event_;</div>
</div><!-- fragment --><p>"Port delivery of Data" are handlers called that were registered with a Port that has an N-cycle delay:</p>
<div class="fragment"><div class="line">MyBlock::MyBlock(...) : <span class="comment">// ...</span></div>
<div class="line">{</div>
<div class="line">    in_port_.registerConsumerHandler(</div>
<div class="line">          <a class="code" href="SpartaHandler_8hpp.html#aa0cfa5521686f6c2ca417e1d972ebc45">CREATE_SPARTA_HANDLER</a>(MyBlock, myPortCallback, ...));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Called directly by the Port when data arrives on the Port in THIS</span></div>
<div class="line"><span class="comment">// cycle, but sent from a previous cycle.  In this case, the Port is</span></div>
<div class="line"><span class="comment">// considered N-Cycle and this callback is being called during the</span></div>
<div class="line"><span class="comment">// sparta::SchedulingPhase::PortUpdate phase.  If the Port is 0-cycle,</span></div>
<div class="line"><span class="comment">// this callback is called during the sparta::SchedulingPhase::Tick</span></div>
<div class="line"><span class="comment">// phase.</span></div>
<div class="line"><span class="keywordtype">void</span> MyBlock::myPortCallback(...) {</div>
<div class="line">}</div>
</div><!-- fragment --><p>and "Operating Logic/Events" are those <a class="el" href="classsparta_1_1Event.html" title="Event is a simple class for scheduling random events on the Scheduler.">sparta::Event</a> objects that were created in the <a class="el" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0a0b3516a5bbb77566f904f9d3877f4710" title="Most operations (combinational logic) occurs in this phase.">sparta::SchedulingPhase::Tick</a> phase:</p>
<div class="fragment"><div class="line"><a class="code" href="classsparta_1_1Event.html">sparta::Event&lt;sparta::SchedulingPhase::Tick&gt;</a> my_main_logic_event_;</div>
<div class="line"><span class="comment">// OR use the default template argument</span></div>
<div class="line"><a class="code" href="classsparta_1_1Event.html">sparta::Event&lt;&gt;</a> my_main_logic_event_;</div>
</div><!-- fragment --><h2><a class="anchor" id="using_phase"></a>
Using The Phases</h2>
<ul>
<li>Construction occurs first and only once. During this "phase" the modeler should add <a class="el" href="classsparta_1_1Event.html" title="Event is a simple class for scheduling random events on the Scheduler.">sparta::Event</a>, <a class="el" href="classsparta_1_1Port.html" title="The port interface used to bind port types together and defines a port behavior.">sparta::Port</a>, and <a class="el" href="classsparta_1_1Counter.html" title="Represents a counter of type counter_type (uint64_t). 2 and greater than 0 with a ceiling specified....">sparta::Counter</a> objects to the base class <a class="el" href="classsparta_1_1Unit.html" title="The is the base class for user defined blocks in simulation.">sparta::Unit</a>'s sets:</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Construction phase</span></div>
<div class="line">MyBlock::MyBlock(<a class="code" href="classsparta_1_1TreeNode.html">sparta::TreeNode</a> * node, MyParameters * params) :</div>
<div class="line">    <a class="code" href="namespacesparta.html">sparta</a>::Unit(node),</div>
<div class="line">    my_internal_tick_event_(&amp;Unit::unit_event_set_, <span class="stringliteral">&quot;my_internal_tick_event&quot;</span>,</div>
<div class="line">                            <a class="code" href="SpartaHandler_8hpp.html#aa0cfa5521686f6c2ca417e1d972ebc45">CREATE_SPARTA_HANDLER</a>(MyBlock, myInternalTickCallback)),</div>
<div class="line">    my_other_internal_tick_event_(&amp;Unit::unit_event_set_, <span class="stringliteral">&quot;my_other_internal_tick_event&quot;</span>,</div>
<div class="line">                                  <a class="code" href="SpartaHandler_8hpp.html#aa0cfa5521686f6c2ca417e1d972ebc45">CREATE_SPARTA_HANDLER</a>(MyBlock, myInternalTickCallbackV2)),</div>
<div class="line">    my_inport_(&amp;Unit::unit_port_set_, <span class="stringliteral">&quot;my_inport&quot;</span>, 1)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Establish internal precedences here that can&#39;t be done automatically</span></div>
<div class="line">    my_internal_tick_event_ &gt;&gt; my_other_internal_tick_event_;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Also, register handlers with any InPorts defined</span></div>
<div class="line">    my_inport_.registerConsumerHandler(<a class="code" href="SpartaHandler_8hpp.html#aa0cfa5521686f6c2ca417e1d972ebc45">CREATE_SPARTA_HANDLER</a>(MyBlock, myCallback));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// PortUpdate Phase</span></div>
<div class="line"><span class="keywordtype">void</span> MyBlock::myCallback()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// my_inport_ received a message</span></div>
<div class="line">    my_internal_tick_event_.schedule();  <span class="comment">// schedule internal tick event for this cycle</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 The framework will automatically set precedence between registered <a class="el" href="classsparta_1_1Event.html" title="Event is a simple class for scheduling random events on the Scheduler.">sparta::Event</a> objects in the <a class="el" href="classsparta_1_1EventSet.html" title="Set of Events that a unit (or sparta::TreeNode, sparta::Resource) contains and are visible through a ...">sparta::EventSet</a> and registered <a class="el" href="classsparta_1_1Port.html" title="The port interface used to bind port types together and defines a port behavior.">sparta::Port</a> objects in the <a class="el" href="classsparta_1_1PortSet.html" title="A TreeNode that represents a set of ports used by a Resource.">sparta::PortSet</a>. However, the framework will <em>not</em> set precedence between events <em>defined directly</em> in the block. I.e. if there is an event called <code>my_first_event_</code> created in the <a class="el" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0a0b3516a5bbb77566f904f9d3877f4710" title="Most operations (combinational logic) occurs in this phase.">sparta::SchedulingPhase::Tick</a> phase, and another event called <code>my_second_event_</code> also created in the <a class="el" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0a0b3516a5bbb77566f904f9d3877f4710" title="Most operations (combinational logic) occurs in this phase.">sparta::SchedulingPhase::Tick</a> phase, the order in which these events are scheduled is random (however, persistent from simulation to simulation run) <em>unless</em> a precedence is established: <br  />
 </p><div class="fragment"><div class="line">my_first_event_ &gt;&gt; my_second_event_;</div>
</div><!-- fragment --><p> <br  />
 Automatic precedence establishment can be disabled by calling the method sparta::Resource::setAutoPrecedence(false) in the constructor of MyBlock.</p>
<ul>
<li>After the block is instantiated and the simulator is now running, events will be scheduled based on established operations.</li>
</ul>
<div class="dotgraph">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="poly" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0" title="UpdatePhase" alt="" coords="158,535,154,527,143,521,126,515,105,512,82,511,58,512,37,515,20,521,9,527,5,535,9,542,20,549,37,554,58,557,82,559,105,557,126,554,143,549,154,542"/>
<area shape="poly" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0" title="PortUpdate" alt="" coords="149,224,146,217,136,210,121,205,102,201,82,200,61,201,42,205,27,210,17,217,14,224,17,231,27,238,42,243,61,247,82,248,102,247,121,243,136,238,146,231"/>
<area shape="poly" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0" title="Collection" alt="" coords="146,321,143,314,133,307,119,302,101,299,82,297,62,299,44,302,30,307,21,314,17,321,21,329,30,335,44,341,62,344,82,345,101,344,119,341,133,335,143,329"/>
<area shape="poly" href="namespacesparta.html#aeec80d237ace9f07634c3d24c9aed9a0" title="Tick" alt="" coords="118,419,116,411,111,405,103,399,93,396,82,395,70,396,60,399,52,405,47,411,45,419,47,426,52,433,60,438,70,441,82,443,93,441,103,438,111,433,116,426"/>
</map>
</div>
<ul>
<li>Scheduled <b>UpdatePhase</b> events are run first, allowing a user to update, clear, or simply operate on anything in their block that needs to be ready to accept data from a Port or from a Tick event</li>
<li>Scheduled <b>PortUpdate</b> events (for N-cycle Ports) are run next allowing Ports to deliver data to themselves as well as any registered consumer handler. Since resources were updated earlier, they can be updated</li>
<li>Scheduled <b>Collection</b> events are now run to collect current state on the resources going into the Tick phase. This is part of the PipelineCollector mechanism and allows a modeler to see what data was operated on THIS cycle.</li>
<li>Scheduled <b>Tick</b> events are finally run to operate on data sent from N-Cycle ports or data in internal resources. 0-cycle Ports are also run in this phase delivering data directly to the callback from another block. Any collection required on this type of data must be handled manually. Most of the modeler's code will be in this phase.</li>
</ul>
<ul>
<li>Simulation will terminate when there are no more continuing events scheduled for execution. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclasssparta_1_1TreeNode_html"><div class="ttname"><a href="classsparta_1_1TreeNode.html">sparta::TreeNode</a></div><div class="ttdoc">Node in a composite tree representing a sparta Tree item.</div><div class="ttdef"><b>Definition:</b> <a href="TreeNode_8hpp_source.html#l00204">TreeNode.hpp:205</a></div></div>
<div class="ttc" id="aSpartaAssert_8hpp_html_adec1baa114339781efa7b68071b82a29"><div class="ttname"><a href="SpartaAssert_8hpp.html#adec1baa114339781efa7b68071b82a29">SPARTA_EXPECT_FALSE</a></div><div class="ttdeci">#define SPARTA_EXPECT_FALSE(x)</div><div class="ttdoc">A macro for hinting to the compiler a particular condition should be considered most likely false.</div><div class="ttdef"><b>Definition:</b> <a href="SpartaAssert_8hpp_source.html#l00027">SpartaAssert.hpp:27</a></div></div>
<div class="ttc" id="aclasssparta_1_1Event_html"><div class="ttname"><a href="classsparta_1_1Event.html">sparta::Event</a></div><div class="ttdoc">Event is a simple class for scheduling random events on the Scheduler.</div><div class="ttdef"><b>Definition:</b> <a href="Event_8hpp_source.html#l00041">Event.hpp:42</a></div></div>
<div class="ttc" id="aclasssparta_1_1log_1_1MessageSource_html"><div class="ttname"><a href="classsparta_1_1log_1_1MessageSource.html">sparta::log::MessageSource</a></div><div class="ttdoc">Message source object associated with a sparta TreeNode through which messages can be sent.</div><div class="ttdef"><b>Definition:</b> <a href="MessageSource_8hpp_source.html#l00034">MessageSource.hpp:35</a></div></div>
<div class="ttc" id="aSpartaHandler_8hpp_html_aa0cfa5521686f6c2ca417e1d972ebc45"><div class="ttname"><a href="SpartaHandler_8hpp.html#aa0cfa5521686f6c2ca417e1d972ebc45">CREATE_SPARTA_HANDLER</a></div><div class="ttdeci">#define CREATE_SPARTA_HANDLER(clname, meth)</div><div class="ttdef"><b>Definition:</b> <a href="SpartaHandler_8hpp_source.html#l00314">SpartaHandler.hpp:314</a></div></div>
<div class="ttc" id="anamespacesparta_html"><div class="ttname"><a href="namespacesparta.html">sparta</a></div><div class="ttdoc">Macros for handling exponential backoff.</div><div class="ttdef"><b>Definition:</b> <a href="AppTriggers_8hpp_source.html#l00022">AppTriggers.hpp:22</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Sep 25 2020 04:28:26 for The Sparta Modeling Framework by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
